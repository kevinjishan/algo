
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETH 그리드 트레이딩 PnL 보고서</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" />
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .status-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50; }
        .status-card.warning { border-left-color: #ff9800; }
        .status-card.danger { border-left-color: #f44336; }
        .metric { font-size: 24px; font-weight: bold; color: #333; }
        .label { font-size: 14px; color: #666; margin-bottom: 5px; }
        .change { font-size: 12px; }
        .positive { color: #4CAF50; }
        .negative { color: #f44336; }
        .neutral { color: #666; }
        .positions { margin: 20px 0; }
        .position { background: #f1f3f4; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .trades { margin: 20px 0; }
        .timestamp { text-align: center; color: #666; font-size: 12px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f5f5f5; font-weight: 600; }
        .chart-container { width: 100%; height: 350px; margin: 30px 0; }
        .calendar-container { width: 100%; margin: 30px 0; }
        .indicator-box { display: flex; gap: 20px; margin: 20px 0; }
        .indicator { background: #e3f2fd; padding: 10px 20px; border-radius: 8px; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 ETH 그리드 트레이딩 PnL 보고서</h1>
            <h3>실시간 성과 모니터링</h3>
        </div>
        
        <div class="status-grid">
            <div class="status-card">
                <div class="label">💰 지갑 잔고</div>
                <div class="metric">$729.10</div>
                <div class="change positive">
                    24h: $+0.00
                </div>
            </div>
            
            <div class="status-card warning">
                <div class="label">📈 미실현 손익</div>
                <div class="metric negative">$-0.13</div>
                <div class="change positive">
                    24h: $+0.00
                </div>
            </div>
            
            <div class="status-card">
                <div class="label">📊 수익률</div>
                <div class="metric negative">-0.02%</div>
                <div class="change">총 마진 기준</div>
            </div>
            
            <div class="status-card">
                <div class="label">💎 ETH 가격</div>
                <div class="metric">$2562.35</div>
                <div class="change positive">
                    24h: +0.07%
                </div>
            </div>
        </div>
        
        <div class="chart-container" id="pnl_chart"></div>
        <div class="chart-container" id="wallet_chart"></div>
        <div class="calendar-container">
            <div id="calendar"></div>
        </div>
        <div class="indicator-box">
            <div class="indicator">RSI: 65.67</div>
            <div class="indicator">MA: 2540.64</div>
            <div class="indicator">ATR: 13.83</div>
            <div class="indicator">펀딩비: 0.00 USDT</div>
            <div class="indicator">레버리지: 0.00x</div>
        </div>
        <div class="positions">
            <h3>🎯 현재 포지션/그리드 상태</h3>
            
        
            <div class="position">
                <strong>LONG</strong>: 0.336000 ETH @ $2550.53 
                | 가치: $860.99 
                | PnL: <span class="positive">$4.02 (1.66%)</span>
            </div>
            
            <div class="position">
                <strong>SHORT</strong>: 0.338000 ETH @ $2550.23 
                | 가치: $866.12 
                | PnL: <span class="negative">$-4.14 (-2.39%)</span>
            </div>
            
        </div>
        
                 <div class="trades">
             <h3>📋 거래 요약 (최근 30분)</h3>
            <table>
                <tr>
                    <th>항목</th>
                    <th>값</th>
                </tr>
                <tr>
                    <td>거래 건수</td>
                    <td>0건</td>
                </tr>
                <tr>
                    <td>매수량</td>
                    <td>0.000000 ETH ($0.00)</td>
                </tr>
                <tr>
                    <td>매도량</td>
                    <td>0.000000 ETH ($0.00)</td>
                </tr>
                <tr>
                    <td>🔧 실제 PnL (미실현 손익)</td>
                    <td class="negative">
                        $-0.13
                    </td>
                </tr>
                <tr>
                    <td>포지션 변화</td>
                    <td class="positive">
                        +0.000000 ETH
                    </td>
                </tr>
                <tr>
                    <td>수수료</td>
                    <td>$0.000</td>
                </tr>
            </table>
        </div>
        
        <div class="timestamp">
            마지막 업데이트: 2025-07-08T19:51:15.298360
        </div>
    </div>
    <script>
    // 차트/달력용 데이터 (실제 데이터는 2차에서 삽입)
    const realizedPnl = [{'date': '2025-07-08', 'realized': 4.184072549998957}, {'date': '2025-07-08', 'realized': 4.184072549998957}, {'date': '2025-07-08', 'realized': 23.27232014999905}, {'date': '2025-07-08', 'realized': 3.2239493499990495}, {'date': '2025-07-08', 'realized': 403.24655621999943}];
    const unrealizedPnl = [{'date': '2025-07-08', 'unrealized': -0.00459566}, {'date': '2025-07-08', 'unrealized': -0.00664963}, {'date': '2025-07-08', 'unrealized': -0.24498398}, {'date': '2025-07-08', 'unrealized': -0.2373612}, {'date': '2025-07-08', 'unrealized': -0.12581122}];
    const walletTrend = [{'date': '2025-07-08', 'balance': 732.28279922}, {'date': '2025-07-08', 'balance': 732.28279922}, {'date': '2025-07-08', 'balance': 731.16764169}, {'date': '2025-07-08', 'balance': 731.16764169}, {'date': '2025-07-08', 'balance': 729.10091939}];
    const fundingFee = [{'date': '2025-07-08', 'funding': 0}, {'date': '2025-07-08', 'funding': 0}, {'date': '2025-07-08', 'funding': 0}, {'date': '2025-07-08', 'funding': 0}, {'date': '2025-07-08', 'funding': 0}];
    const leverageFee = [{'date': '2025-07-08', 'leverage': 0}, {'date': '2025-07-08', 'leverage': 0}, {'date': '2025-07-08', 'leverage': 0}, {'date': '2025-07-08', 'leverage': 0}, {'date': '2025-07-08', 'leverage': 0}];
    // --- 실현/미실현 손익, 잔고 추이 Plotly 차트 (1차) ---
    const dates = realizedPnl.map(x => x.date);
    const realized = realizedPnl.map(x => x.realized);
    const unrealized = unrealizedPnl.map(x => x.unrealized);
    const wallet = walletTrend.map(x => x.balance);
    Plotly.newPlot('pnl_chart', [
      {x: dates, y: realized, name: '실현 손익', type: 'scatter', mode: 'lines+markers', line: {color: '#4CAF50'}},
      {x: dates, y: unrealized, name: '미실현 손익', type: 'scatter', mode: 'lines+markers', line: {color: '#2196F3'}}
    ], {title: '실현/미실현 손익 추이', xaxis: {title: '날짜'}, yaxis: {title: 'USDT'}, legend: {orientation: 'h'}});
    Plotly.newPlot('wallet_chart', [
      {x: dates, y: wallet, name: '지갑 잔고', type: 'scatter', mode: 'lines+markers', line: {color: '#FF9800'}}
    ], {title: '지갑 잔고 추이', xaxis: {title: '날짜'}, yaxis: {title: 'USDT'}});
    // --- 펀딩비/레버리지비 차트 ---
    const funding = fundingFee.map(x => x.funding);
    const leverage = leverageFee.map(x => x.leverage);
    Plotly.newPlot('funding_chart', [
      {x: dates, y: funding, name: '펀딩비', type: 'bar', marker: {color: '#00bcd4'}},
      {x: dates, y: leverage, name: '레버리지비', type: 'bar', marker: {color: '#9c27b0'}}
    ], {barmode: 'group', title: '펀딩비/레버리지비', xaxis: {title: '날짜'}, yaxis: {title: 'USDT'}});
    // --- 달력(heatmap) ---
    const calendarEl = document.getElementById('calendar');
    const calendarEvents = realizedPnl.map(x => {
      title: (x.realized >= 0 ? '+' : '') + x.realized,
      start: x.date,
      color: x.realized > 0 ? '#4CAF50' : (x.realized < 0 ? '#f44336' : '#bdbdbd')
    });
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {left: 'prev,next today', center: 'title', right: 'dayGridMonth,dayGridWeek,dayGridYear'},
      events: calendarEvents,
      eventDisplay: 'block',
      height: 500
    });
    calendar.render();
    // 포지션/그리드 테이블 예시 (Python 객체 → JSON)
    const positions = [{"side": "LONG", "amount": 0.336, "entry_price": 2550.527579696, "market_value": 860.99369804, "pnl": 4.01643127, "pnl_rate": 1.66}, {"side": "SHORT", "amount": 0.338, "entry_price": 2550.226088893, "market_value": 866.11866053, "pnl": -4.14224249, "pnl_rate": -2.39}];
    const posDiv = document.querySelector('.positions');
    let posTable = `<table><tr><th>구분</th><th>수량</th><th>진입가</th><th>가치</th><th>PnL</th></tr>`;
    if (positions && positions.length > 0) {
      positions.forEach(pos => {
        posTable += `<tr><td>${pos.side}</td><td>${pos.amount}</td><td>${pos.entry_price}</td><td>${pos.market_value}</td><td>${pos.pnl}</td></tr>`;
      });
    }
    posTable += `</table>`;
    posDiv.innerHTML += posTable;
    </script>
</body>
</html>
        